devtools::build()
devtools::install()
rm(list=ls())
library(wfdb.R)
library(cardiac.output)
data=rdsamp("D:/Datasets/mimic3wdb-matched/p00/p000020/p000020-2183-04-28-17-47")
abp=data[,3]
abp = data[150000:152000,3]
onsets=wabp(abp)
onsets
onset.times = wabp(abp)
features = abpfeature(abp,onset.times)
t = (1:length(abp)-1)/125
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange')) +
geom_vline(aes(xintercept=features$endof.systole.rr/125,color='red')) +
scale_color_manual(name='Onset Markers', guide='legend',values=c('blue','orange','red'),
labels=c('Beat Onset','Time of Systole','End of Systole'))
cardiac.output = liljestrand.estimate.co.waveform(abp, 6000)
rownames(features)
colnames(features)
devtools::build()
devtools::install()
library(cardiac.output)
rm(list=ls())
library(wfdb.R)
library(cardiac.output)
data=rdsamp("D:/Datasets/mimic3wdb-matched/p00/p000020/p000020-2183-04-28-17-47")
abp = data[150000:152000,3]
onset.times = wabp(abp)
features = abpfeature(abp,onset.times)
t = (1:length(abp)-1)/125
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange')) +
geom_vline(aes(xintercept=features$endof.systole.rr/125,color='red')) +
scale_color_manual(name='Onset Markers', guide='legend',values=c('blue','orange','red'),
labels=c('Beat Onset','Time of Systole','End of Systole'))
cardiac.output = liljestrand.estimate.co.waveform(abp, 6000)
library(ggplot2)
rm(list=ls())
library(wfdb.R)
library(cardiac.output)
data=rdsamp("D:/Datasets/mimic3wdb-matched/p00/p000020/p000020-2183-04-28-17-47")
abp = data[150000:152000,3]
onset.times = wabp(abp)
features = abpfeature(abp,onset.times)
t = (1:length(abp)-1)/125
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange')) +
geom_vline(aes(xintercept=features$endof.systole.rr/125,color='red')) +
scale_color_manual(name='Onset Markers', guide='legend',values=c('blue','orange','red'),
labels=c('Beat Onset','Time of Systole','End of Systole'))
cardiac.output = liljestrand.estimate.co.waveform(abp, 6000)
features$time.systole
onset.times = wabp(abp)
features = abpfeature(abp,onset.times)
t = (1:length(abp)-1)/125
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange')) +
geom_vline(aes(xintercept=features$endof.systole.rr/125,color='red')) +
scale_color_manual(name='Onset Markers', guide='legend',values=c('blue','orange','red'),
labels=c('Beat Onset','Time of Systole','End of Systole'))
cardiac.output = liljestrand.estimate.co.waveform(abp, 6000)
qplot(t,abp,geom='line')
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue'))
features$time.systole/125
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange')) +
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange'))
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange')) +
geom_vline(aes(xintercept=features$endof.systole.rr/125,color='red'))
features$end.of.systole.rr
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange'))
features$time.systole
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange')) +
geom_vline(aes(xintercept=features$endof.systole.rr/125,color='red')) +
scale_color_manual(name='Onset Markers', guide='legend',values=c('blue','orange','red'),
labels=c('Beat Onset','Time of Systole','End of Systole'))
length(features$time.systole)
length(features$end.of.systole.rr)
qplot(t,abp,geom='line') + geom_vline(aes(xintercept=onset.times/125,color='blue')) +
geom_vline(aes(xintercept=features$time.systole/125,color='orange')) +
geom_vline(aes(xintercept=features$end.of.systole.rr/125,color='red')) +
scale_color_manual(name='Onset Markers', guide='legend',values=c('blue','orange','red'),
labels=c('Beat Onset','Time of Systole','End of Systole'))
o=wabp(data[1:1000,3])
abp=data[1:1000,3]
plot(abp)
offset = 1600;
scale = 20;
Araw = abp*scale-offset;
# LPF
A = signal::filter(c(1, 0, 0, 0, 0, -2, 0, 0, 0, 0, 1), c(1, -2, 1), Araw)/24 + 30
A = (A[-(1:3)] + offset)/scale
# Slope-sum function
dypos = A[-1] - A[-length(A)]
dypos[dypos<0] = 0
ssf = c(0, 0, convolve(rep(1,16),rev(dypos),type='open'))
# Decision rule
avg0 = sum(ssf[1:1000])/1000
Threshold0 = 3*avg0
# Ignoring "learning period" for now
lockout = 0
timer = 0
z = rep(0,100000)
counter = 0
t=50
lockout = lockout - 1
timer = timer + 1
length(ssf)
lockout < 1 && ssf[t]>avg0+5
lockout<1
ssf[t]
avg0
avg0
ssf
sum(ssf[1:1000])
sum(is.na(ssf[1:1000]))
# Decision rule
avg0 = sum(na.omit(ssf[1:1000]))/1000
Threshold0 = 3*avg0
avg0
devtools::build()
devtools::install()
rm(list=ls())
library(wfdb.R)
library(cardiac.output)
library(ggplot2)
data=rdsamp("D:/Datasets/mimic3wdb-matched/p00/p000020/p000020-2183-04-28-17-47")
abp = data[150000:152000,3]
onset.times = wabp(abp)
features = abpfeature(abp,onset.times)
t = (1:length(abp)-1)/125
abp=data[1:1000,3]
o=wabp(abp)
o
